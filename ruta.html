<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cobranza MÃ³vil</title>

<style>
body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:#f3f4f6}
.view{display:none}
header{background:#111827;color:#fff;padding:16px;display:flex;justify-content:space-between;align-items:center}
.small{font-size:12px;color:#9ca3af}
.box{background:#fff;margin:16px;padding:16px;border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,.06)}
.item{padding:14px;border-radius:14px;background:#f9fafb;margin-bottom:10px}
.btn{width:100%;padding:14px;border:none;border-radius:14px;font-size:16px;margin-top:10px}
.green{background:#16a34a;color:#fff}
.gray{background:#e5e7eb}
.red{background:#ef4444;color:#fff}
input,select{width:100%;padding:12px;margin-top:8px;border-radius:10px;border:1px solid #ddd}

.dashboard{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:16px}
.card{background:#fff;border-radius:16px;padding:14px;box-shadow:0 4px 10px rgba(0,0,0,.06)}
.greenLine{border-left:6px solid #16a34a}
.blueLine{border-left:6px solid #2563eb}
.orangeLine{border-left:6px solid #f97316}
.grayLine{border-left:6px solid #6b7280}

.bottom-nav{position:fixed;bottom:0;left:0;right:0;display:flex;background:#fff;border-top:1px solid #e5e7eb}
.bottom-nav button{flex:1;padding:10px 4px;border:none;background:none;font-size:16px;line-height:1.1}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;justify-content:center;align-items:center;z-index:1000}
.modal-box{background:#fff;padding:24px;border-radius:18px;width:90%;max-width:360px;text-align:center}
.hidden{display:none}
</style>
</head>

<body>

<!-- INICIO -->
<div id="inicioView" class="view">
  <div class="box" style="text-align:center;margin-top:60px">
    <h2>ğŸ¢ PRODUCCIONES CULTURALES DE MÃ‰XICO</h2>
    <p class="small" id="fechaHoraInicio"></p>
    <button class="btn green" onclick="abrirLoginAdmin()">âš™ï¸ ADMINISTRADOR</button>
    <button class="btn gray" onclick="abrirLoginCobrador()">ğŸš¶ COBRADOR</button>
  </div>
</div>

<!-- LOGIN ADMIN -->
<div id="loginAdminModal" class="modal">
  <div class="modal-box">
    <h3>âš™ï¸ Acceso Administrador</h3>
    <input type="password" id="adminPass" placeholder="ContraseÃ±a">
    <button class="btn green" onclick="loginAdmin()">Aceptar</button>
    <button class="btn gray" onclick="cerrarLoginAdmin()">Cancelar</button>
  </div>
</div>

<!-- LOGIN COBRADOR -->
<div id="loginCobradorModal" class="modal">
  <div class="modal-box">
    <h3>ğŸš¶ Acceso Cobrador</h3>
    <select id="cobradorLogin"></select>
    <input type="password" id="cobradorPass" placeholder="ContraseÃ±a">
    <button class="btn green" onclick="loginCobrador()">Entrar</button>
    <button class="btn gray" onclick="cerrarLoginCobrador()">Cancelar</button>
  </div>
</div>

<!-- ADMIN -->
<div id="adminView" class="view">
<header>
  <div>âš™ï¸ <strong>Administrador</strong><br><span class="small" id="fechaHoraAdmin"></span></div>
  <button class="btn red" style="width:auto" onclick="logout()">Salir</button>
</header>

<!-- DASHBOARD -->
<div id="adminDashboard">
  <div class="dashboard">
    <div class="card greenLine"><span>ğŸ’° Cobrado hoy</span><strong>$0</strong></div>
    <div class="card blueLine"><span>ğŸ“… Cobrado mes</span><strong>$0</strong></div>
    <div class="card orangeLine"><span>â³ Saldo pendiente</span><strong>$0</strong></div>
    <div class="card grayLine"><span>ğŸ‘¥ Clientes</span><strong id="totalClientes">0</strong></div>
  </div>
</div>

<!-- CLIENTES -->
<div id="adminClientes" class="hidden">
  <div class="box">
    <h4>ğŸ‘¥ Clientes</h4>
    <input id="cliNombre" placeholder="Nombre">
    <input id="cliTel" placeholder="TelÃ©fono">
    <select id="cliCobrador"></select>
    <button class="btn gray" onclick="capturarUbicacion()">ğŸ“ Capturar ubicaciÃ³n</button>
    <button class="btn green" onclick="guardarCliente()">Guardar cliente</button>
    <hr>
    <div id="listaClientes"></div>
  </div>
</div>

<!-- COBRADORES (RESTAURADO) -->
<div id="adminCobradores" class="hidden">
  <div class="box">
    <h4>ğŸ§‘â€ğŸ’¼ Cobradores</h4>
    <input id="cobNombre" placeholder="Nombre">
    <input id="cobPass" placeholder="ContraseÃ±a">
    <button class="btn green" onclick="guardarCobrador()">Guardar cobrador</button>
    <hr>
    <div id="listaCobradores"></div>
  </div>
</div>

<nav class="bottom-nav">
  <button onclick="verDashboard()">ğŸ <br><span class="small">Inicio</span></button>
  <button onclick="verClientes()">ğŸ‘¥<br><span class="small">Clientes</span></button>
  <button onclick="verCobradores()">ğŸ§‘â€ğŸ’¼<br><span class="small">Cobradores</span></button>
</nav>
</div>

<!-- COBRADOR -->
<div id="cobradorView" class="view">
<header>
  <div>ğŸš¶ <strong id="cobradorNombre"></strong><br><span class="small" id="fechaHoraCobrador"></span></div>
  <button class="btn red" style="width:auto" onclick="logout()">Salir</button>
</header>

<div class="box">
  <h4>ğŸ“‹ Mis clientes</h4>
  <div id="rutaClientes"></div>
</div>
</div>

<script>
const ADMIN_PASSWORD="1010";
let cobradores=JSON.parse(localStorage.getItem("cobradores"))||[];
let clientes=JSON.parse(localStorage.getItem("clientes"))||[];
let cobradorActivo=null;
let ubicacionTemp=null;

function show(id){document.querySelectorAll('.view').forEach(v=>v.style.display='none');document.getElementById(id).style.display='block'}
window.onload=()=>{show('inicioView');actualizarFechaHora()}

/* LOGIN */
function abrirLoginAdmin(){loginAdminModal.style.display="flex"}
function cerrarLoginAdmin(){loginAdminModal.style.display="none"}
function loginAdmin(){if(adminPass.value==="1010"){cerrarLoginAdmin();show('adminView');cargarCobradores();renderClientes();renderCobradores()}}

function abrirLoginCobrador(){cargarCobradoresLogin();loginCobradorModal.style.display="flex"}
function cerrarLoginCobrador(){loginCobradorModal.style.display="none"}
function loginCobrador(){
  const c=cobradores.find(c=>c.id==cobradorLogin.value&&c.pass===cobradorPass.value);
  if(!c){alert("Error");return;}
  cobradorActivo=c;cerrarLoginCobrador();show('cobradorView');cobradorNombre.innerText=c.nombre;renderRuta()
}

/* SECCIONES */
function verDashboard(){adminDashboard.classList.remove("hidden");adminClientes.classList.add("hidden");adminCobradores.classList.add("hidden")}
function verClientes(){adminDashboard.classList.add("hidden");adminClientes.classList.remove("hidden");adminCobradores.classList.add("hidden")}
function verCobradores(){adminDashboard.classList.add("hidden");adminClientes.classList.add("hidden");adminCobradores.classList.remove("hidden")}

/* COBRADORES */
function guardarCobrador(){cobradores.push({id:Date.now(),nombre:cobNombre.value,pass:cobPass.value});localStorage.setItem("cobradores",JSON.stringify(cobradores));renderCobradores()}
function renderCobradores(){listaCobradores.innerHTML="";cobradores.forEach(c=>listaCobradores.innerHTML+=`<div class="item">ğŸ‘¤ ${c.nombre}</div>`)}
function cargarCobradores(){cliCobrador.innerHTML='<option value="">Sin asignar</option>';cobradores.forEach(c=>cliCobrador.innerHTML+=`<option value="${c.id}">${c.nombre}</option>`)}
function cargarCobradoresLogin(){cobradorLogin.innerHTML="";cobradores.forEach(c=>cobradorLogin.innerHTML+=`<option value="${c.id}">${c.nombre}</option>`)}

/* CLIENTES */
function capturarUbicacion(){
  navigator.geolocation.getCurrentPosition(p=>{
    ubicacionTemp={lat:p.coords.latitude,lng:p.coords.longitude};
    alert("UbicaciÃ³n capturada");
  });
}
function guardarCliente(){
  clientes.push({id:Date.now(),nombre:cliNombre.value,tel:cliTel.value,cobrador:cliCobrador.value,ubicacion:ubicacionTemp});
  localStorage.setItem("clientes",JSON.stringify(clientes));
  renderClientes();
}
function renderClientes(){
  listaClientes.innerHTML="";
  clientes.forEach(c=>listaClientes.innerHTML+=`<div class="item">ğŸ‘¤ ${c.nombre}</div>`);
  totalClientes.innerText=clientes.length;
}

/* RUTA */
function renderRuta(){
  rutaClientes.innerHTML="";
  clientes.filter(c=>c.cobrador==cobradorActivo.id).forEach(c=>{
    const link=c.ubicacion?`https://maps.google.com/?q=${c.ubicacion.lat},${c.ubicacion.lng}`:"#";
    rutaClientes.innerHTML+=`<div class="item">ğŸ‘¤ ${c.nombre}<br><a href="${link}" target="_blank">ğŸ“ Ver mapa</a></div>`;
  });
}

function logout(){show('inicioView')}

/* FECHA */
function actualizarFechaHora(){
  const d=new Date();
  const t=d.toLocaleString();
  ["fechaHoraInicio","fechaHoraAdmin","fechaHoraCobrador"].forEach(id=>{const e=document.getElementById(id);if(e)e.innerText=t});
}
setInterval(actualizarFechaHora,1000);
</script>

</body>
</html>
