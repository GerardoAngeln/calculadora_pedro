<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SISTEMA PARA REPARACIÃ“N DE EQUIPOS</title>

<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f2f4f7;}
header{background:#0d6efd;color:#fff;padding:15px;text-align:center;font-size:18px;font-weight:bold;}
.container{padding:15px;}
.btn{width:100%;padding:18px;margin:10px 0;font-size:18px;border:none;border-radius:12px;background:#0d6efd;color:#fff;}
.btn.secondary{background:#6c757d;}
.btn.success{background:#198754;}
.btn.warn{background:#ffc107;color:#000;}
.card{background:#fff;border-radius:12px;padding:15px;margin-bottom:15px;}
input,textarea{width:100%;padding:14px;margin-top:10px;font-size:16px;border-radius:10px;border:1px solid #ccc;}
.hidden{display:none;}
.step{animation:fade .25s ease-in-out;}
@keyframes fade{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
.badge{display:inline-block;padding:6px 10px;border-radius:20px;font-size:13px;color:#fff;}
.badge.recibido{background:#0d6efd;}
.badge.proceso{background:#ffc107;color:#000;}
.badge.listo{background:#198754;}
.badge.entregado{background:#000;}
.kv{display:flex;justify-content:space-between;margin:6px 0;}
.hr{height:1px;background:#e5e7eb;margin:10px 0;}
</style>
</head>

<body>
<header>SISTEMA PARA REPARACIÃ“N DE EQUIPOS</header>

<div class="container">

<div id="inicio" class="step">
  <button class="btn" onclick="mostrarPaso('cliente')">âž• Nueva ReparaciÃ³n</button>
  <button class="btn secondary" onclick="mostrarReparaciones()">ðŸ“‹ Reparaciones</button>
</div>

<div id="cliente" class="step hidden">
  <div class="card">
    <h3>ðŸ‘¤ Cliente</h3>
    <input id="clienteNombre" placeholder="Nombre">
    <input id="clienteTelefono" placeholder="TelÃ©fono">
    <button class="btn" onclick="mostrarPaso('equipo')">Siguiente</button>
    <button class="btn secondary" onclick="volverInicio()">Cancelar</button>
  </div>
</div>

<div id="equipo" class="step hidden">
  <div class="card">
    <h3>ðŸ“± Equipo</h3>
    <input id="marca" placeholder="Marca">
    <input id="modelo" placeholder="Modelo">
    <input id="color" placeholder="Color">
    <input id="imei" placeholder="IMEI">
    <button class="btn" onclick="mostrarPaso('falla')">Siguiente</button>
  </div>
</div>

<div id="falla" class="step hidden">
  <div class="card">
    <h3>ðŸ”§ Falla y Pago</h3>
    <textarea id="fallaTexto" placeholder="Describe la falla"></textarea>
    <input id="costo" placeholder="Costo total">
    <input id="anticipo" placeholder="Anticipo inicial">
    <button class="btn" onclick="guardarReparacion()">Guardar ReparaciÃ³n</button>
  </div>
</div>

<div id="lista" class="step hidden"></div>
<div id="detalle" class="step hidden"></div>

</div>

<script>
let indiceDetalle=null;

function mostrarPaso(id){
  document.querySelectorAll('.step').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function volverInicio(){ mostrarPaso('inicio'); }

function guardarReparacion(){
  let rep={
    cliente:clienteNombre.value,
    telefono:clienteTelefono.value,
    marca:marca.value,
    modelo:modelo.value,
    color:color.value,
    imei:imei.value,
    falla:fallaTexto.value,
    costo:Number(costo.value||0),
    pagos:[{monto:Number(anticipo.value||0),fecha:new Date().toLocaleString()}],
    estatus:"recibido",
    fecha:new Date().toLocaleString()
  };
  let data=JSON.parse(localStorage.getItem("reparaciones")||"[]");
  data.push(rep);
  localStorage.setItem("reparaciones",JSON.stringify(data));
  volverInicio();
}

function mostrarReparaciones(){
  mostrarPaso("lista");
  let data=JSON.parse(localStorage.getItem("reparaciones")||"[]");
  lista.innerHTML=data.map((r,i)=>{
    let pagado=r.pagos.reduce((s,p)=>s+p.monto,0);
    return `<div class="card" onclick="verDetalle(${i})">
      <strong>${r.cliente}</strong><br>
      ${r.marca} ${r.modelo}<br>
      ðŸ’° Saldo: $${r.costo-pagado}
    </div>`;
  }).join("")+`<button class="btn secondary" onclick="volverInicio()">Volver</button>`;
}

function verDetalle(i){
  indiceDetalle=i;
  mostrarPaso("detalle");
  let d=JSON.parse(localStorage.getItem("reparaciones"))[i];
  let pagado=d.pagos.reduce((s,p)=>s+p.monto,0);
  detalle.innerHTML=`
  <div class="card">
    <h3>ðŸ“„ Detalle</h3>
    <div class="kv"><span>Cliente</span><strong>${d.cliente}</strong></div>
    <div class="kv"><span>Costo</span><strong>$${d.costo}</strong></div>
    <div class="kv"><span>Pagado</span><strong>$${pagado}</strong></div>
    <div class="kv"><span>Saldo</span><strong>$${d.costo-pagado}</strong></div>
  </div>

  <div class="card">
    <h3>ðŸ’° Pagos</h3>
    ${d.pagos.map(p=>`<div class="kv"><span>${p.fecha}</span><strong>$${p.monto}</strong></div>`).join("")}
    <input id="nuevoPago" placeholder="Nuevo abono">
    <button class="btn success" onclick="agregarPago()">Agregar abono</button>
    <button class="btn warn" onclick="pagoCompleto()">Pago completo</button>
  </div>

  <button class="btn secondary" onclick="mostrarReparaciones()">Volver</button>
  `;
}

function agregarPago(){
  let data=JSON.parse(localStorage.getItem("reparaciones"));
  let monto=Number(nuevoPago.value||0);
  if(monto<=0)return;
  data[indiceDetalle].pagos.push({monto,fecha:new Date().toLocaleString()});
  localStorage.setItem("reparaciones",JSON.stringify(data));
  verDetalle(indiceDetalle);
}

function pagoCompleto(){
  let data=JSON.parse(localStorage.getItem("reparaciones"));
  let d=data[indiceDetalle];
  let pagado=d.pagos.reduce((s,p)=>s+p.monto,0);
  let restante=d.costo-pagado;
  if(restante>0){
    d.pagos.push({monto:restante,fecha:new Date().toLocaleString()});
  }
  d.estatus="entregado";
  localStorage.setItem("reparaciones",JSON.stringify(data));
  verDetalle(indiceDetalle);
}
</script>

</body>
</html>
