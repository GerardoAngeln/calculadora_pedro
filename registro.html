<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Personal</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto}
body{margin:0;background:#f1f3f6;color:#111}
header{background:#0f172a;color:#fff;padding:14px;text-align:center;cursor:pointer}
header h1{margin:0;font-size:16px}
.container{padding:20px 14px;max-width:520px;margin:auto}
.datetime{text-align:center;margin-bottom:24px}
.datetime .date{font-size:13px;color:#374151}
.datetime .time{font-size:22px;font-weight:600}
.card{background:#fff;border-radius:14px;padding:18px;box-shadow:0 6px 16px rgba(0,0,0,.06);margin-bottom:22px}
button{width:100%;padding:12px;border-radius:10px;border:none;font-size:14px;font-weight:600;cursor:pointer;margin-bottom:10px}
.btn-admin{background:#2563eb;color:#fff}
.btn-col{background:#6b7280;color:#fff}
.btn-back{background:#e5e7eb;color:#111}
input,select{width:100%;padding:10px;margin-bottom:14px;border-radius:10px;border:1px solid #d1d5db;font-size:14px}
.hidden{display:none}
.list{border-bottom:1px solid #e5e7eb;padding:10px 0}
.small{font-size:12px;color:#6b7280}
</style>
</head>

<body>

<header onclick="volverInicio()">
<h1>Registro de Personal</h1>
</header>

<div class="container">

<div class="datetime" id="datetime"></div>

<!-- INICIO -->
<div class="card" id="inicio">
<button class="btn-admin" onclick="abrirAdmin()">‚öôÔ∏è ADMIN</button>
<button class="btn-col" onclick="abrirColaborador()">üë§ COLABORADOR</button>
</div>

<!-- LOGIN ADMIN -->
<div class="card hidden" id="loginAdmin">
<h2>Administrador</h2>
<input id="adminPass" type="password" placeholder="Contrase√±a">
<button class="btn-admin" onclick="validarAdmin()">Entrar</button>
<button class="btn-back" onclick="volverInicio()">‚¨ÖÔ∏è Regresar</button>
</div>

<!-- PANEL ADMIN -->
<div class="card hidden" id="panelAdmin">
<h2>Panel Administrador</h2>
<button class="btn-admin" onclick="mostrarAlta()">‚ûï Alta colaborador</button>
<button class="btn-admin" onclick="mostrarLista()">üìã Colaboradores</button>
<button class="btn-admin" onclick="mostrarReporte()">üìä Reporte de beneficiarios</button>
<button class="btn-back" onclick="volverInicio()">‚¨ÖÔ∏è Cerrar sesi√≥n</button>
</div>

<!-- ALTA COLABORADOR -->
<div class="card hidden" id="altaCol">
<h2>Alta Colaborador</h2>
<input id="colNombre" placeholder="Nombre completo">
<input id="colPassNew" type="password" placeholder="Contrase√±a">
<input id="colZona" placeholder="Zona">
<select id="colEstatus">
<option value="activo">Activo</option>
<option value="baja">Baja</option>
</select>
<button class="btn-admin" onclick="guardarColaborador()">Guardar</button>
<button class="btn-back" onclick="volverPanelAdmin()">‚¨ÖÔ∏è Regresar</button>
</div>

<!-- LISTA COLABORADORES -->
<div class="card hidden" id="listaCol">
<h2>Colaboradores</h2>
<div id="lista"></div>
<button class="btn-back" onclick="volverPanelAdmin()">‚¨ÖÔ∏è Regresar</button>
</div>

<!-- REPORTE -->
<div class="card hidden" id="reporte">
<h2>Reporte de Beneficiarios</h2>
<select id="filtroCol" onchange="cargarReporte()"></select>
<div id="tablaReporte"></div>
<button class="btn-admin" onclick="exportarExcel()">Exportar Excel</button>
<button class="btn-admin" onclick="exportarPDF()">Exportar PDF</button>
<button class="btn-back" onclick="volverPanelAdmin()">‚¨ÖÔ∏è Regresar</button>
</div>

<!-- LOGIN COLABORADOR -->
<div class="card hidden" id="loginCol">
<h2>Colaborador</h2>
<select id="selectCol"></select>
<input id="colPass" type="password" placeholder="Contrase√±a">
<button class="btn-col" onclick="validarColaborador()">Entrar</button>
<button class="btn-back" onclick="volverInicio()">‚¨ÖÔ∏è Regresar</button>
</div>

<!-- PANEL COLABORADOR -->
<div class="card hidden" id="panelCol">
<h2>Mi Informaci√≥n</h2>
<div id="infoCol"></div>
<button class="btn-col" onclick="mostrarBenefCol()">üë®‚Äçüë©‚Äçüëß Mis Beneficiarios</button>
<button class="btn-back" onclick="volverInicio()">‚¨ÖÔ∏è Cerrar sesi√≥n</button>
</div>

<!-- BENEFICIARIOS COLABORADOR -->
<div class="card hidden" id="benefCol">
<h2>Mis Beneficiarios</h2>
<input id="bNombre" placeholder="Nombre">
<input id="bTel" placeholder="Tel√©fono">
<input id="bCorreo" placeholder="Correo">
<input id="bDir" placeholder="Direcci√≥n">
<select id="bEst">
<option value="activo">Activo</option>
<option value="baja">Baja</option>
</select>
<button class="btn-col" onclick="guardarBenefCol()">Guardar Beneficiario</button>
<div id="listaBen"></div>
<button class="btn-back" onclick="volverPanelCol()">‚¨ÖÔ∏è Regresar</button>
</div>

</div>

<script>
/* FECHA Y HORA */
function actualizarFechaHora(){
const n=new Date();
const f=n.toLocaleDateString('es-MX',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
let h=n.getHours(),m=n.getMinutes().toString().padStart(2,'0'),a=h>=12?'PM':'AM';
h=h%12||12;
datetime.innerHTML=`<div class="date">${f}</div><div class="time">${h}:${m} ${a}</div>`;
}
setInterval(actualizarFechaHora,1000);actualizarFechaHora();

/* STORAGE */
const hash=t=>btoa(t);
const getCols=()=>JSON.parse(localStorage.getItem('colaboradores'))||[];
const setCols=d=>localStorage.setItem('colaboradores',JSON.stringify(d));
let actual=null;

/* NAV */
function ocultar(){document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'))}
function volverInicio(){ocultar();inicio.classList.remove('hidden')}
function volverPanelAdmin(){ocultar();panelAdmin.classList.remove('hidden')}
function volverPanelCol(){ocultar();panelCol.classList.remove('hidden')}

/* ADMIN */
function abrirAdmin(){ocultar();loginAdmin.classList.remove('hidden')}
function validarAdmin(){adminPass.value==='1234'?(ocultar(),panelAdmin.classList.remove('hidden')):alert('Contrase√±a incorrecta')}
function mostrarAlta(){ocultar();altaCol.classList.remove('hidden')}
function guardarColaborador(){
let c=getCols();
c.push({numero:c.length+1,nombre:colNombre.value,password:hash(colPassNew.value),
zona:colZona.value,estatus:colEstatus.value,fechaAlta:new Date().toLocaleDateString(),beneficiarios:[]});
setCols(c);alert('Colaborador guardado');volverPanelAdmin()
}
function mostrarLista(){
ocultar();listaCol.classList.remove('hidden');lista.innerHTML='';
getCols().forEach(c=>{
lista.innerHTML+=`<div class="list"><b>${c.numero} - ${c.nombre}</b><br><span class="small">${c.zona} | ${c.estatus}</span></div>`;
});
}
function mostrarReporte(){
ocultar();reporte.classList.remove('hidden');
filtroCol.innerHTML='<option value="">Selecciona colaborador</option>';
getCols().forEach((c,i)=>filtroCol.innerHTML+=`<option value="${i}">${c.numero} - ${c.nombre}</option>`);
tablaReporte.innerHTML='';
}
function cargarReporte(){
let i=filtroCol.value;if(i===''){tablaReporte.innerHTML='';return;}
let c=getCols()[i],h='';
c.beneficiarios.forEach(b=>h+=`<div class="list"><b>${b.nombre}</b><br><span class="small">${b.telefono} | ${b.correo}</span></div>`);
tablaReporte.innerHTML=h||'<p class="small">Sin beneficiarios</p>';
}
function exportarExcel(){
let d=[];getCols().forEach(c=>c.beneficiarios.forEach(b=>d.push({Colaborador:c.nombre,Beneficiario:b.nombre,Telefono:b.telefono,Correo:b.correo})));
let ws=XLSX.utils.json_to_sheet(d),wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,'Reporte');
XLSX.writeFile(wb,'reporte_beneficiarios.xlsx');
}
function exportarPDF(){html2pdf().from(tablaReporte).save('reporte_beneficiarios.pdf')}

/* COLABORADOR */
function abrirColaborador(){ocultar();cargarColaboradores();loginCol.classList.remove('hidden')}
function cargarColaboradores(){
selectCol.innerHTML='';
getCols().forEach((c,i)=>selectCol.innerHTML+=`<option value="${i}">${c.numero} - ${c.nombre}</option>`);
}
function validarColaborador(){
let i=selectCol.value,c=getCols()[i];
if(!c||c.password!==hash(colPass.value)){alert('Contrase√±a incorrecta');return}
actual=i;ocultar();panelCol.classList.remove('hidden');
infoCol.innerHTML=`<b>${c.nombre}</b><br>Zona: ${c.zona}<br>Estatus: ${c.estatus}<br>Fecha alta: ${c.fechaAlta}`;
}
function mostrarBenefCol(){ocultar();benefCol.classList.remove('hidden');listarBenefCol()}
function guardarBenefCol(){
let c=getCols();
c[actual].beneficiarios.push({nombre:bNombre.value,telefono:bTel.value,correo:bCorreo.value,direccion:bDir.value,estatus:bEst.value,fechaIngreso:new Date().toLocaleDateString()});
setCols(c);listarBenefCol()
}
function listarBenefCol(){
listaBen.innerHTML='';
getCols()[actual].beneficiarios.forEach((b,i)=>listaBen.innerHTML+=`<div class="list"><b>${b.nombre}</b><br><span class="small">${b.telefono}</span><button onclick="eliminarBenef(${i})">Eliminar</button></div>`);
}
function eliminarBenef(i){let c=getCols();c[actual].beneficiarios.splice(i,1);setCols(c);listarBenefCol()}
</script>

</body>
</html>
