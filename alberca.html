<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Palapas & Albercas</title>

<style>
body{margin:0;font-family:system-ui,sans-serif;background:#f2f4f7}
header{background:#0d9488;color:white;padding:22px;text-align:center}
.container{padding:16px}
.card{background:white;border-radius:14px;padding:14px;box-shadow:0 3px 8px rgba(0,0,0,.08);margin-bottom:16px}
.btn{width:100%;padding:14px;border:none;border-radius:14px;background:#0d9488;color:white;font-size:16px;font-weight:600;margin-top:10px}
.btn.sec{background:#0f766e}
.place{padding:12px;border-radius:10px;margin-top:8px;font-size:14px}
.libre{background:#dcfce7}
.parcial{background:#fef3c7}
.ocupado{background:#fee2e2}
.alerta{background:#fecaca}
input,select{width:100%;padding:12px;margin-top:10px;border-radius:10px;border:1px solid #d1d5db}
.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.day{padding:10px;text-align:center;border-radius:8px;font-size:13px}
</style>
</head>

<body>

<header>
  <h1>ğŸ–ï¸ Palapas & Albercas</h1>
  <p>Agenda, administraciÃ³n y seguimiento</p>
</header>

<!-- BOTÃ“N ADMIN -->
<div class="container">
  <button class="btn sec" onclick="mostrarAdmin()">ğŸ“Š AdministraciÃ³n</button>
</div>

<!-- ================== OPERACIÃ“N ================== -->
<div class="container" id="operacion">

  <div class="card">
    <strong>ğŸ“… Selecciona fecha</strong>
    <input type="date" id="fecha" onchange="revisarFecha()">

    <div class="place libre" id="cv">ğŸ–ï¸ CAMINO VIEJO</div>
    <div class="place libre" id="art">ğŸ–ï¸ ART-YAD</div>

    <button class="btn" id="btnRentar" onclick="mostrarFormulario()">Registrar renta</button>
  </div>

  <div class="card" id="formulario" style="display:none">
    <strong>ğŸ“ Datos del cliente</strong>

    <input id="cliente" placeholder="Nombre del cliente">
    <input id="telefono" placeholder="TelÃ©fono WhatsApp (10 dÃ­gitos)" maxlength="10">
    <select id="espacio"></select>
    <input id="total" type="number" placeholder="Total $">
    <input id="anticipo" type="number" placeholder="Anticipo $ (opcional)">

    <button class="btn" onclick="guardarYEnviar()">Enviar WhatsApp</button>
  </div>

</div>

<!-- ================== ADMIN ================== -->
<div class="container" id="admin" style="display:none">

  <div class="card">
    <strong>ğŸ”” Alertas</strong>
    <div id="alertas"></div>
  </div>

  <div class="card">
    <strong>ğŸ“… Calendario mensual</strong>
    <div id="calendario" class="grid"></div>
  </div>

  <div class="card">
    <strong>ğŸ“‹ Rentas registradas</strong>
    <div id="listaRentas"></div>
  </div>

  <button class="btn" onclick="cerrarAdmin()">â¬…ï¸ Volver</button>
</div>

<script>
function mostrarFormulario(){
  document.getElementById("formulario").style.display="block";
}

function guardarYEnviar(){
  const r={
    fecha:fecha.value,
    cliente:cliente.value,
    telefono:telefono.value,
    espacio:espacio.value,
    total:Number(total.value),
    anticipo:Number(anticipo.value||0)
  };
  r.estado = r.anticipo < r.total ? "SEPARADO" : "LIQUIDADO";

  const rentas=JSON.parse(localStorage.getItem("rentas"))||[];
  rentas.push(r);
  localStorage.setItem("rentas",JSON.stringify(rentas));

  const msg=`ğŸ–ï¸ COMPROBANTE DE RENTA
Espacio: ${r.espacio}
Cliente: ${r.cliente}
Fecha: ${r.fecha}
Total: $${r.total}
Anticipo: $${r.anticipo}
Saldo: $${r.total-r.anticipo}`;

  window.open(`https://wa.me/52${r.telefono}?text=${encodeURIComponent(msg)}`,"_blank");
}

function revisarFecha(){
  const rentas=JSON.parse(localStorage.getItem("rentas"))||[];
  const f=fecha.value;
  let cv=false,art=false;
  rentas.forEach(r=>{
    if(r.fecha===f){
      if(r.espacio==="CAMINO VIEJO")cv=true;
      if(r.espacio==="ART-YAD")art=true;
    }
  });

  cv?cvDiv("ocupado"):cvDiv("libre");
  art?artDiv("ocupado"):artDiv("libre");

  espacio.innerHTML="";
  if(!cv) espacio.innerHTML+=`<option>CAMINO VIEJO</option>`;
  if(!art) espacio.innerHTML+=`<option>ART-YAD</option>`;
}

function cvDiv(c){document.getElementById("cv").className=`place ${c}`;}
function artDiv(c){document.getElementById("art").className=`place ${c}`;}

function mostrarAdmin(){
  operacion.style.display="none";
  admin.style.display="block";
  cargarAdmin();
}

function cerrarAdmin(){
  admin.style.display="none";
  operacion.style.display="block";
}

function cargarAdmin(){
  const rentas=JSON.parse(localStorage.getItem("rentas"))||[];
  listaRentas.innerHTML="";
  calendario.innerHTML="";
  alertas.innerHTML="";

  const hoy=new Date();

  rentas.forEach(r=>{
    const d=new Date(r.fecha);
    const diff=(d-hoy)/(1000*60*60*24);
    if(diff<=1 && r.anticipo<r.total){
      alertas.innerHTML+=`ğŸ”´ Pendiente de liquidar: ${r.cliente}<br>`;
    }

    listaRentas.innerHTML+=`
      <div class="place ${r.anticipo<r.total?'parcial':'libre'}">
        ${r.fecha} - ${r.espacio}<br>${r.cliente}
      </div>`;
  });
}
</script>

</body>
</html>
