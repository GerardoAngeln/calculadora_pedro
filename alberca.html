<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Palapas & Albercas</title>

<style>
body{margin:0;font-family:system-ui,sans-serif;background:#f2f4f7}
header{background:#0d9488;color:white;padding:22px;text-align:center}
.container{padding:16px}
.card{background:white;border-radius:14px;padding:14px;box-shadow:0 3px 8px rgba(0,0,0,.08);margin-bottom:16px}
.btn{width:100%;padding:14px;border:none;border-radius:14px;background:#0d9488;color:white;font-size:16px;font-weight:600;margin-top:10px}
.btn.sec{background:#0f766e}
.place{padding:12px;border-radius:10px;margin-top:8px;font-size:14px}
.libre{background:#dcfce7}
.ocupado{background:#fee2e2}
.parcial{background:#fef3c7}
.alerta{background:#fecaca}

input,select{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:1px solid #d1d5db;
  font-size:15px
}

/* ğŸ”¹ FECHA COMPACTA (ÃšNICO CAMBIO VISUAL) */
.fecha-box{
  display:flex;
  align-items:center;
  gap:8px;
  background:#f9fafb;
  border:1px solid #e5e7eb;
  border-radius:10px;
  padding:6px 10px;
  margin-top:8px;
}
.fecha-box span{
  font-size:18px;
}
.fecha-box input{
  border:none;
  background:transparent;
  padding:4px;
  font-size:14px;
}
.fecha-box input:focus{
  outline:none;
}

.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.day{padding:10px;text-align:center;border-radius:8px;font-size:13px}
.small{font-size:13px}
</style>
</head>

<body>

<header>
  <h1>ğŸ–ï¸ Palapas & Albercas</h1>
  <p>Agenda Â· AdministraciÃ³n Â· Abonos</p>
</header>

<div class="container">
  <button class="btn sec" onclick="mostrarAdmin()">ğŸ“Š AdministraciÃ³n</button>
</div>

<!-- ================= OPERACIÃ“N ================= -->
<div class="container" id="operacion">

  <div class="card">
    <strong>ğŸ“… Selecciona fecha</strong>

    <!-- FECHA COMPACTA DENTRO DEL CUADRO -->
    <div class="fecha-box">
      <span>ğŸ“…</span>
      <input type="date" id="fecha" onchange="revisarFecha()">
    </div>

    <div id="cv" class="place libre">ğŸ–ï¸ CAMINO VIEJO <strong>DISPONIBLE</strong></div>
    <div id="art" class="place libre">ğŸ–ï¸ ART-YAD <strong>DISPONIBLE</strong></div>

    <button class="btn" id="btnRentar" onclick="mostrarFormulario()">Registrar renta</button>
  </div>

  <div class="card" id="formulario" style="display:none">
    <strong>ğŸ“ Datos del cliente</strong>

    <input id="cliente" placeholder="Nombre del cliente">
    <input id="telefono" placeholder="TelÃ©fono WhatsApp (10 dÃ­gitos)" maxlength="10">
    <select id="espacio"></select>
    <input id="total" type="number" placeholder="Total $">
    <input id="abonadoInicial" type="number" placeholder="Abono inicial $ (opcional)">

    <button class="btn" onclick="guardarRenta()">Guardar y enviar WhatsApp</button>
  </div>

</div>

<!-- ================= ADMIN ================= -->
<div class="container" id="admin" style="display:none">

  <div class="card">
    <strong>ğŸ”” Alertas</strong>
    <div id="alertas" class="small"></div>
  </div>

  <div class="card">
    <strong>ğŸ“… Calendario mensual</strong>
    <div id="calendario" class="grid"></div>
  </div>

  <div class="card">
    <strong>ğŸ“‹ Rentas registradas</strong>
    <div id="listaRentas"></div>
  </div>

  <button class="btn" onclick="cerrarAdmin()">â¬…ï¸ Volver</button>
</div>

<script>
function obtenerRentas(){return JSON.parse(localStorage.getItem("rentas"))||[]}
function guardarRentas(r){localStorage.setItem("rentas",JSON.stringify(r))}

function mostrarFormulario(){formulario.style.display="block"}

/* VALIDACIÃ“N HISTÃ“RICA */
function revisarFecha(){
  const f=fecha.value;
  if(!f)return;

  const rentas=obtenerRentas();
  let cvO=false,artO=false;

  rentas.forEach(r=>{
    if(r.fecha===f){
      if(r.espacio==="CAMINO VIEJO")cvO=true;
      if(r.espacio==="ART-YAD")artO=true;
    }
  });

  cv.className=`place ${cvO?'ocupado':'libre'}`;
  cv.innerHTML=`ğŸ–ï¸ CAMINO VIEJO <strong>${cvO?'OCUPADA':'DISPONIBLE'}</strong>`;

  art.className=`place ${artO?'ocupado':'libre'}`;
  art.innerHTML=`ğŸ–ï¸ ART-YAD <strong>${artO?'OCUPADA':'DISPONIBLE'}</strong>`;

  espacio.innerHTML='<option value="">Selecciona el espacio</option>';
  if(!cvO)espacio.innerHTML+='<option value="CAMINO VIEJO">CAMINO VIEJO</option>';
  if(!artO)espacio.innerHTML+='<option value="ART-YAD">ART-YAD</option>';

  btnRentar.disabled=cvO&&artO;
  btnRentar.textContent=btnRentar.disabled?'Fecha no disponible':'Registrar renta';
}

/* GUARDAR RENTA */
function guardarRenta(){
  const r={
    fecha:fecha.value,
    cliente:cliente.value,
    telefono:telefono.value,
    espacio:espacio.value,
    total:Number(total.value),
    abonado:Number(abonadoInicial.value||0)
  };

  if(!r.fecha||!r.cliente||!r.telefono||!r.espacio||!r.total){
    alert("Completa todos los campos");
    return;
  }

  const rentas=obtenerRentas();
  rentas.push(r);
  guardarRentas(rentas);

  window.open(`https://wa.me/52${r.telefono}?text=${encodeURIComponent(
`ğŸ–ï¸ COMPROBANTE DE RENTA
Espacio: ${r.espacio}
Cliente: ${r.cliente}
Fecha: ${r.fecha}

Total: $${r.total}
Abonado: $${r.abonado}
Saldo: $${r.total-r.abonado}`)}`,"_blank");
}

/* ADMIN */
function mostrarAdmin(){
  operacion.style.display="none";
  admin.style.display="block";
  cargarAdmin();
}
function cerrarAdmin(){
  admin.style.display="none";
  operacion.style.display="block";
}

function cargarAdmin(){
  const rentas=obtenerRentas();
  listaRentas.innerHTML="";
  calendario.innerHTML="";
  alertas.innerHTML="";
  const hoy=new Date(),dias={};

  rentas.forEach(r=>{
    const saldo=r.total-r.abonado;
    const diff=Math.ceil((new Date(r.fecha)-hoy)/(1000*60*60*24));
    if(saldo>0&&diff<=1){
      alertas.innerHTML+=`ğŸ”´ ${r.cliente} (${r.fecha})<br>`;
    }
    dias[r.fecha]=(dias[r.fecha]||0)+1;

    listaRentas.innerHTML+=`
      <div class="place ${saldo===0?'libre':saldo>0&&diff>1?'parcial':'alerta'}">
        ğŸ“… ${r.fecha}<br>
        ğŸ–ï¸ ${r.espacio}<br>
        ğŸ‘¤ ${r.cliente}<br>
        ğŸ’° Total: $${r.total} | ğŸ’µ Abonado: $${r.abonado} | ğŸ’³ Saldo: $${saldo}
      </div>`;
  });

  const d=new Date(),y=d.getFullYear(),m=d.getMonth();
  const ult=new Date(y,m+1,0).getDate();
  for(let i=1;i<=ult;i++){
    const f=`${y}-${String(m+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`;
    calendario.innerHTML+=`<div class="day ${
      dias[f]>=2?'ocupado':dias[f]===1?'parcial':'libre'
    }">${i}</div>`;
  }
}
</script>

</body>
</html>
